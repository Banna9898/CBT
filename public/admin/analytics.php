<?php require_once __DIR__ . '/../../config/db.php'; require_admin(); require_once __DIR__ . '/../../includes/header.php'; $data = $pdo->query('SELECT exams.title, COUNT(attempts.id) as attempts, COALESCE(AVG(attempts.score),0) as avg_score FROM exams LEFT JOIN attempts ON attempts.exam_id=exams.id GROUP BY exams.id')->fetchAll(PDO::FETCH_ASSOC); ?>
<div class="row"><div class="col-md-3"><div class="list-group"><a href="dashboard.php" class="list-group-item">Dashboard</a><a href="analytics.php" class="list-group-item active">Analytics</a></div></div><div class="col-md-9"><h3>Analytics</h3><canvas id="chart" height="120"></canvas></div></div>
<?php require_once __DIR__ . '/../../includes/footer.php'; ?>
<script>const labels = <?php echo json_encode(array_column($data,'title')); ?>; const values = <?php echo json_encode(array_map(function($d){return floatval($d['avg_score']);}, $data)); ?>; const ctx=document.getElementById('chart').getContext('2d'); new Chart(ctx,{type:'bar',data:{labels:labels,datasets:[{label:'Avg Score',data:values}]}});</script>